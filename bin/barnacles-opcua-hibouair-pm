#!/usr/bin/env node

const opcua = require('node-opcua');
const BarnaclesOPCUA = require('../lib/barnaclesopcua.js');

const INITIAL_HOLDOFF_MILLISECONDS = 5000;
const UPDATE_PERIOD_MILLISECONDS = 60000;


let barnaclesOPCUA = new BarnaclesOPCUA({ printErrors: true });
setTimeout(generateSensorData, INITIAL_HOLDOFF_MILLISECONDS);


function generateSensorData() {
  let dynamb = {
    deviceId: "41b00a145977",
    deviceIdType: 3,
    illuminance: Math.round(Math.random() * 300),
    "pm1.0": (Math.random() * 5),
    "pm2.5": (Math.random() * 30),
    "pm10": (Math.random() * 100),
    pressure: 98000 + (Math.random() * 4000),
    relativeHumidity: 30 + Math.round(Math.random() * 40),
    temperature: 21 + (Math.random() * 10),
    timestamp: Date.now(),
    volatileOrganicCompoundsConcentration: (Math.random() * 5)
  };

  barnaclesOPCUA.handleEvent('dynamb', dynamb);
  setTimeout(generateSensorData, UPDATE_PERIOD_MILLISECONDS);
}


console.log('barnacles-opcua HibouAir PM sensor simulator');
